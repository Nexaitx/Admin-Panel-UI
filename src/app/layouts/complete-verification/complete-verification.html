<div class="container-fluid">
    <div class="logout text-end">
        <button mat-icon-button (click)="logout()" class="logout" matTooltip="Logout" matTooltipPosition="below">
            <mat-icon>logout</mat-icon>
        </button>
    </div>

    <mat-card class="verif-card">
        <h2>Pharmacist Verification</h2>
        <mat-horizontal-stepper linear #stepper *ngIf="uploadProgress === null">
            <mat-step [stepControl]="documentsForm">
                <form [formGroup]="documentsForm">
                    <ng-template matStepLabel>Upload Documents</ng-template>

                    <p class="helper">Please upload clear scanned copies or photos (max 5 MB each). Accepted: jpg, png,
                        pdf</p>

                    <!-- Drug / Pharmacy License -->
                    <div class="file-row">
                        <label>Drug / Pharmacy License <span class="required">*</span></label>
                        <input type="file" formControlName="licenseFile" (change)="onFileSelected($event, 'license')"
                            accept=".jpg,.jpeg,.png,.pdf" />
                        <div class="file-info" *ngIf="licenseName">Selected: {{ licenseName }}</div>
                        <mat-error *ngIf="documentsForm.get('license')?.hasError('required')">Drug License is
                            required</mat-error>
                    </div>

                    <!-- PAN or Aadhaar - user can upload either; we enforce at least one -->
                    <div class="file-row">
                        <label>PAN or Aadhaar (any one) <span class="required">*</span></label>
                        <input type="file" formControlName="idProofFile" (change)="onFileSelected($event, 'id')"
                            accept=".jpg,.jpeg,.png,.pdf" />
                        <div class="file-info" *ngIf="idName">Selected: {{ idName }}</div>
                        <!-- <mat-hint *ngIf="!idPresent">Upload either PAN or Aadhaar. You can upload both if available.</mat-hint> -->
                    </div>

                    <div class="step-actions">
                        <button mat-button matStepperPrevious>Back</button>
                        <button mat-button matStepperNext>Next</button>
                        <!-- <button mat-button matStepperNext [disabled]="!documentsForm.valid">Next</button> -->
                    </div>
                </form>
            </mat-step>

            <!-- STEP 3: Pharmacy address -->
            <mat-step [stepControl]="addressForm">
                <form [formGroup]="addressForm">
                    <ng-template matStepLabel>Pharmacy Address</ng-template>

                    <mat-form-field appearance="outline" class="full-width mt-2">
                        <mat-label>Pharmacy name</mat-label>
                        <input matInput formControlName="pharmacyName" required>
                        <mat-error *ngIf="addressForm.get('pharmacyName')?.hasError('required')">Required</mat-error>
                    </mat-form-field>

                    <mat-form-field appearance="outline" class="full-width">
                        <mat-label>Address line 1</mat-label>
                        <input matInput formControlName="address1" required>
                        <mat-error *ngIf="addressForm.get('address1')?.hasError('required')">Required</mat-error>
                    </mat-form-field>

                    <mat-form-field appearance="outline" class="full-width">
                        <mat-label>Address line 2</mat-label>
                        <input matInput formControlName="address2">
                    </mat-form-field>

                    <div class="row-two">
                        <mat-form-field appearance="outline">
                            <mat-label>City</mat-label>
                            <input matInput formControlName="city" required>
                            <mat-error *ngIf="addressForm.get('city')?.hasError('required')">Required</mat-error>
                        </mat-form-field>

                        <mat-form-field appearance="outline">
                            <mat-label>State</mat-label>
                            <input matInput formControlName="state" required>
                            <mat-error *ngIf="addressForm.get('state')?.hasError('required')">Required</mat-error>
                        </mat-form-field>
                    </div>

                    <div class="row-two">
                        <mat-form-field appearance="outline">
                            <mat-label>Pincode</mat-label>
                            <input matInput formControlName="pincode" required pattern="[0-9]{6}">
                            <mat-error *ngIf="addressForm.get('pincode')?.hasError('required')">Required</mat-error>
                            <mat-error *ngIf="addressForm.get('pincode')?.hasError('pattern')">Enter a valid 6-digit
                                pincode</mat-error>
                        </mat-form-field>

                        <mat-form-field appearance="outline">
                            <mat-label>Country</mat-label>
                            <input matInput formControlName="country" required>
                            <mat-error *ngIf="addressForm.get('country')?.hasError('required')">Required</mat-error>
                        </mat-form-field>
                    </div>
                    <div class="terms-section">
                        <span> I accept the <a href="javascript:void(0)" (click)="openTermsDialog()">Terms &
                                Conditions</a></span>
                    </div>

                    <div class="step-actions">
                        <button mat-button matStepperPrevious>Back</button>
                        <button mat-raised-button color="primary" (click)="submit()"
                            [disabled]="!termsAcceptedInDialog || addressForm.invalid || submitting">Submit</button>
                    </div>
                </form>
            </mat-step>

        </mat-horizontal-stepper>
        <div class="upload-progress" *ngIf="uploadProgress !== null">
            <mat-progress-spinner mode="determinate" [value]="uploadProgress"></mat-progress-spinner>
            <div>{{ uploadProgress }}% uploaded</div>
        </div>
    </mat-card>
    <ng-template #termsDialog>
        <h2 mat-dialog-title>Terms and Conditions</h2>
        <mat-dialog-content>
            <div class="terms-content">
                <p><strong>Vitoxyz Pharmacy Terms and Conditions</strong></p>
                <p>
                    By registering as a pharmacist with Vitoxyz, you agree to the following terms and conditions:
                </p>
                <ul>
                    <li>You must provide accurate and complete information during the verification process.</li>
                    <li>All uploaded documents (e.g., Drug/Pharmacy License, PAN/Aadhaar) must be valid and authentic.
                    </li>
                    <li>Vitoxyz reserves the right to verify and approve your account based on the provided documents.
                    </li>
                    <li>You agree to comply with all applicable laws and regulations related to pharmacy operations in
                        India.</li>
                    <li>Any misuse of the platform may result in account suspension or termination.</li>
                    <li>Vitoxyz is not liable for any errors in the information provided by you during registration.
                    </li>
                    <li>Your account will be activated only after successful verification by the Vitoxyz admin team.
                    </li>
                </ul>
                <p>Please review these terms carefully before accepting.</p>
                <mat-checkbox [(ngModel)]="termsAcceptedInDialog" color="primary">
                    I accept the Terms and Conditions
                </mat-checkbox>
            </div>
        </mat-dialog-content>
        <mat-dialog-actions align="end">
            <button mat-button (click)="dialog.closeAll()">Cancel</button>
            <button mat-raised-button color="primary" (click)="dialog.closeAll()" [disabled]="!termsAcceptedInDialog">
                Accept
            </button>
        </mat-dialog-actions>
    </ng-template>
</div>