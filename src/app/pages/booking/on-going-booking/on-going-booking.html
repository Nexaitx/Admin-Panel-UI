<div class="">
    <mat-form-field appearance="outline">
        <mat-label>Search bookings</mat-label>
        <input matInput (keyup)="applyFilter($event)" placeholder="e.g. john" #input class="rounded-md">
        <mat-icon matSuffix>search</mat-icon>
    </mat-form-field>
    <div class="scrollableTable overflow-x-auto">
        <table mat-table [dataSource]="dataSource" matSort>

            <!-- Serial No Column -->
            <ng-container matColumnDef="serial_no" sticky="true">
                <th mat-header-cell *matHeaderCellDef>S.No</th>
                <td mat-cell *matCellDef="let element; let i = index">{{i + 1}}</td>
            </ng-container>

            <!-- Booking No Column -->
            <ng-container matColumnDef="booking_no">
                <th mat-header-cell *matHeaderCellDef>Booking&nbsp;No</th>
                <td mat-cell *matCellDef="let element">{{element.bookingId || element.booking_no || element.id || '-'}}</td>
            </ng-container>

            <!-- Shift Start Column -->
            <ng-container matColumnDef="shift_start">
                <th mat-header-cell *matHeaderCellDef>Shift&nbsp;Start</th>
                <td mat-cell *matCellDef="let element">{{`${element.startTimeHour}:${element.startTimeMinute}${element.startTimeAmPm}` || '-'}}</td>
            </ng-container>

            <!-- Shift End Column -->
            <ng-container matColumnDef="shift_end">
                <th mat-header-cell *matHeaderCellDef>Shift&nbsp;End</th>
                <td mat-cell *matCellDef="let element">{{`${element.endTimeHour}:${element.endTimeMinute}${element.endTimeAmPm}` || '-'}}</td>
            </ng-container>

            <!-- Login Time Column -->
            <ng-container matColumnDef="login_time">
                <th mat-header-cell *matHeaderCellDef>Login&nbsp;Time</th>
                <td mat-cell *matCellDef="let element">{{element.loginTime ? (element.loginTime | date:'short') : (element.login_time || '-')}}</td>
            </ng-container>

            <!-- Login Selfie Column -->
            <ng-container matColumnDef="login_selfie">
                <th mat-header-cell *matHeaderCellDef>Selfie</th>
                <td mat-cell *matCellDef="let element">
                    <img *ngIf="element.loginSelfiePath || element.login_selfie" 
                        [src]="getSelfieUrl(element.loginSelfiePath || element.login_selfie)"
                        alt="Login Selfie"
                        class="w-10 h-10 rounded object-cover selfie-small rounded-lg shadow-sm cursor-pointer"
                        (click)="openImage(getSelfieUrl(element.loginSelfiePath || element.login_selfie))">
                    <span *ngIf="!element.loginSelfiePath && !element.login_selfie">-</span>
                </td>
            </ng-container>

            <!-- Staff IP Address Column -->
            <ng-container matColumnDef="staff_ip_address">
                <th mat-header-cell *matHeaderCellDef>Staff&nbsp;IP&nbsp;Address</th>
                <td mat-cell *matCellDef="let element">{{element.staffIpAddress || element.staff_ip_address || '-'}}</td>
            </ng-container>

            <!-- Staff Latitude Column -->
            <ng-container matColumnDef="staff_latitude">
                <th mat-header-cell *matHeaderCellDef>Staff&nbsp;Latitude</th>
                <td mat-cell *matCellDef="let element">{{element.latitude || element.staff_latitude || '-'}}</td>
            </ng-container>

            <!-- Staff Longitude Column -->
            <ng-container matColumnDef="staff_longitude">
                <th mat-header-cell *matHeaderCellDef>Staff&nbsp;Longitude</th>
                <td mat-cell *matCellDef="let element">{{element.longitude || element.staff_longitude || '-'}}</td>
            </ng-container>

            <!-- User Name Column -->
            <ng-container matColumnDef="user_name">
                <th mat-header-cell *matHeaderCellDef>User&nbsp;Name</th>
                <td mat-cell *matCellDef="let element">{{element.user?.name || element.userName || element.user_name || '-'}}</td>
            </ng-container>

            <!-- Staff Name Column -->
            <ng-container matColumnDef="staff_name">
                <th mat-header-cell *matHeaderCellDef>Staff&nbsp;Name</th>
                <td mat-cell *matCellDef="let element">{{element.staff?.name || element.staffName || element.staff_name || '-'}}</td>
            </ng-container>

            <!-- Shift Total Price Column -->
            <ng-container matColumnDef="shift_total_price">
                <th mat-header-cell *matHeaderCellDef>Total&nbsp;Price</th>
                <td mat-cell *matCellDef="let element">â‚¹{{element.shiftTotalPrice || element.shift_total_price || element.price || '-'}}</td>
            </ng-container>

            <!-- Status Column -->
            <ng-container matColumnDef="status">
                <th mat-header-cell *matHeaderCellDef>Status</th>
                <td mat-cell *matCellDef="let element">
                    <span class="px-2 py-1 rounded-pill text-xs font-medium" [ngClass]="{
                        'bg-green text-green-800': element.status === 'CONFIRMED' || element.status === 'accept',
                        'bg-red text-red-800': element.status === 'inactive' || element.status === 'completed',
                        'bg-yellow text-yellow-800': element.status === 'pending',
                        'bg-blue text-blue-800': element.status === 'started'
                      }">
                        {{element.status || '-' | titlecase}}
                    </span>
                </td>
            </ng-container>

            <!-- Actions Column -->
            <ng-container matColumnDef="actions">
                <th mat-header-cell *matHeaderCellDef>Actions</th>
                <td mat-cell *matCellDef="let element">
                    <button mat-icon-button [matMenuTriggerFor]="actionMenu">
                        <mat-icon>more_vert</mat-icon>
                    </button>
                    <mat-menu #actionMenu="matMenu">
                        <button mat-menu-item>
                            <mat-icon>visibility</mat-icon>
                            <span>Show</span>
                        </button>
                        <button mat-menu-item>
                            <mat-icon>edit</mat-icon>
                            <span>Edit</span>
                        </button>
                    </mat-menu>
                </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="columnsToDisplay; sticky: true"></tr>
            <tr mat-row *matRowDef="let row; columns: columnsToDisplay;"></tr>
        </table>
    </div>
    <mat-paginator [pageSizeOptions]="[10, 25, 100]" aria-label="Select page of bookings"
        class="mt-4 rounded-lg shadow-sm"></mat-paginator>

    <div *ngIf="!isLoading && dataSource.data.length === 0" class="p-8 text-center text-gray-500">
        No bookings to display.
    </div>
</div>