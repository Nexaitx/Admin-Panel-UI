<mat-tab-group (selectedTabChange)="onTabChange($event)" [(selectedIndex)]="activeTabIndex" animationDuration="300ms">
  @if(user?.role?.roleType === 'Admin') {
  <mat-tab label="Orders in Cart">
    <div class="tab-content pt-3">
      <div class="toolbar d-flex align-items-baseline mb-2">
        <mat-icon>filter_list</mat-icon>

        <mat-form-field appearance="outline" class="ms-2 small-select">
          <mat-label>Search Cart</mat-label>
          <input matInput (keyup)="applyCartFilter($event)" placeholder="Search by product, customer, etc.">
        </mat-form-field>

        <mat-paginator class="ms-auto" #cartPaginator [pageSizeOptions]="[5, 10, 20, 100]" showFirstLastButtons>
        </mat-paginator>
      </div>
      <section>
        <table mat-table [dataSource]="cartOrders" matSort #cartSort="matSort">
          <ng-container matColumnDef="s_no" sticky>
            <th mat-header-cell *matHeaderCellDef mat-sort-header> S.No </th>
            <td mat-cell *matCellDef="let element; let i = index">
              {{ i + 1 }}
            </td>
          </ng-container>

          <ng-container matColumnDef="id" sticky>
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Cart ID </th>
            <td mat-cell *matCellDef="let item"> {{ item.id }} </td>
          </ng-container>

          <ng-container matColumnDef="productName">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Cart Items </th>
            <td mat-cell *matCellDef="let item"> <a href="google.com" target="_blank" rel="noopener noreferrer">{{
                item.productName }}</a> </td>
          </ng-container>

          <ng-container matColumnDef="productType">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Product Type </th>
            <td mat-cell *matCellDef="let item"> {{ item.productType || 'N/A' }} </td>
          </ng-container>

          <ng-container matColumnDef="adminName">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Pharmacist Name </th>
            <td mat-cell *matCellDef="let item"> {{ item.adminName }} </td>
          </ng-container>

          <ng-container matColumnDef="adminEmail">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Pharmacist Email </th>
            <td mat-cell *matCellDef="let item"> {{ item.adminEmail }} </td>
          </ng-container>

          <ng-container matColumnDef="productForm">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Form </th>
            <td mat-cell *matCellDef="let item"> {{ item.productForm }} </td>
          </ng-container>

          <ng-container matColumnDef="quantity">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Qty </th>
            <td mat-cell *matCellDef="let item"> {{ item.quantity }} </td>
          </ng-container>

          <ng-container matColumnDef="price">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Price </th>
            <td mat-cell *matCellDef="let item"> {{ item.price | number:'1.2-2' }} </td>
          </ng-container>

          <ng-container matColumnDef="totalPrice">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Total </th>
            <td mat-cell *matCellDef="let item"> {{ item.totalPrice | number:'1.2-2' }} </td>
          </ng-container>

          <ng-container matColumnDef="userName">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Customer </th>
            <td mat-cell *matCellDef="let item"> {{ item.userName }} </td>
          </ng-container>

          <ng-container matColumnDef="userEmail">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> User Email </th>
            <td mat-cell *matCellDef="let item"> {{ item.userEmail }} </td>
          </ng-container>

          <ng-container matColumnDef="addedDate">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Added Date </th>
            <td mat-cell *matCellDef="let item">
              {{ item.addedDate | date:'medium' }}
            </td>
          </ng-container>

          <ng-container matColumnDef="actions" stickyEnd>
            <th mat-header-cell *matHeaderCellDef> Actions </th>
            <td mat-cell *matCellDef="let item">
              <button mat-icon-button color="primary" (click)="onView(item)">
                <mat-icon>visibility</mat-icon>
              </button>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="cartColumns; sticky: true"></tr>
          <tr mat-row *matRowDef="let row; columns: cartColumns;"></tr>
        </table>
      </section>

    </div>
  </mat-tab>
  }
  <mat-tab label="Processed Orders">
    <div class="tab-content pt-3">
      <div class="toolbar d-flex align-items-center mb-2">
        <mat-icon>filter_list</mat-icon>
        <mat-form-field appearance="outline" class="ms-2 small-select">
          <mat-label>Filter by Status</mat-label>
          <mat-select [(value)]="selectedOrderType" (selectionChange)="onOrderTypeChange($event.value)">
            @for (type of orderStatuses; track type) {
            <mat-option [value]="type">
              {{ type | titlecase }}
            </mat-option>
            }
          </mat-select>
        </mat-form-field>
        <mat-form-field appearance="outline" class="ms-2 small-select">
          <mat-label>Search Orders</mat-label>
          <input matInput (keyup)="applyProcessedFilter($event)" placeholder="Search by order ID, customer, etc.">
        </mat-form-field>
        <mat-paginator class="ms-auto" #processedPaginator [pageSizeOptions]="[5, 10, 20, 100]" showFirstLastButtons>
        </mat-paginator>
      </div>

      <!-- Processed orders table -->
      <section>
        <table mat-table [dataSource]="processedOrders" matSort #processedSort="matSort">
          <ng-container matColumnDef="s_no" sticky>
            <th mat-header-cell *matHeaderCellDef mat-sort-header> S.No </th>
            <td mat-cell *matCellDef="let element; let i = index">
              {{ i + 1 }}
            </td>
          </ng-container>
          <!-- All original columns -->
          <!-- <ng-container matColumnDef="orderId" sticky="true">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> Order ID </th>
                <td mat-cell *matCellDef="let item"> {{ item.orderId }} </td>
              </ng-container> -->

          <ng-container matColumnDef="orderNumber" sticky="true">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Order Number </th>
            <td mat-cell *matCellDef="let item"> {{ item.orderNumber }} </td>
          </ng-container>

          <ng-container matColumnDef="orderItems" sticky="true">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Order Items </th>
            <td mat-cell *matCellDef="let item"> View Items </td>
          </ng-container>

          <ng-container matColumnDef="orderValue">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Order Value </th>
            <td mat-cell *matCellDef="let item"> 950 </td>
          </ng-container>

          <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Order Status </th>
            <td mat-cell *matCellDef="let item"> {{ item.status }} </td>
          </ng-container>

          <ng-container matColumnDef="userName">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> User Name </th>
            <td mat-cell *matCellDef="let item"> {{ item.userName }} </td>
          </ng-container>

          <ng-container matColumnDef="userPhone">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Phone </th>
            <td mat-cell *matCellDef="let item"> {{ item.userPhone }} </td>
          </ng-container>

          <ng-container matColumnDef="userEmail">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Address </th>
            <td mat-cell *matCellDef="let item"> {{ item.userEmail }} </td>
          </ng-container>

          <ng-container matColumnDef="paymentStatus">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Payment Status </th>
            <td mat-cell *matCellDef="let item"> {{ item.paymentStatus }} </td>
          </ng-container>

          <ng-container matColumnDef="orderDate">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Order Date </th>
            <td mat-cell *matCellDef="let item"> {{ item.orderDate | date: 'mediumDate' }} </td>
          </ng-container>

          <ng-container matColumnDef="expectedDeliveryDate">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> ETA </th>
            <td mat-cell *matCellDef="let item"> {{ item.expectedDeliveryDate | date: 'mediumDate' }} </td>
          </ng-container>

          <ng-container matColumnDef="packingStatus">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Packing&nbsp;Status </th>
            <td mat-cell *matCellDef="let item">
              <!-- <mat-form-field appearance="outline" style="width:100%;"> -->
              <select class="form-select form-select-sm w-100" [(value)]="item.packingStatus"
                (selectionChange)="onPackingStatusChange(item)">
                <option *ngFor="let s of packingStatuses" [value]="s.value">
                  {{ s.viewValue }}
                </option>
              </select>
              <!-- </mat-form-field> -->
            </td>
          </ng-container>

          <ng-container matColumnDef="dispatchStatus">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Dispatch&nbsp;Status </th>
            <td mat-cell *matCellDef="let item">
              <select class="form-select form-select-sm w-100" [(value)]="item.dispatchStatus"
                (selectionChange)="onDispatchStatusChange(item)">
                <option *ngFor="let s of dispatchStatuses" [value]="s.value">
                  {{ s.viewValue }}</option>
              </select>
            </td>
          </ng-container>

          <ng-container matColumnDef="orderStatus">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Order&nbsp;Status </th>
            <td mat-cell *matCellDef="let item">
              <select class="form-select form-select-sm w-100" [(value)]="item.dispatchStatus"
                (selectionChange)="onDispatchStatusChange(item)">
                <option *ngFor="let s of dispatchStatuses" [value]="s.value">
                  {{ s.viewValue }}</option>
              </select>
            </td>
          </ng-container>
          <ng-container matColumnDef="deliveryStatus">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Delivery&nbsp;Status </th>
            <td mat-cell *matCellDef="let item">
              <select class="form-select form-select-sm w-100" [(value)]="item.dispatchStatus"
                (selectionChange)="onDispatchStatusChange(item)">
                <option *ngFor="let s of dispatchStatuses" [value]="s.value">
                  {{ s.viewValue }}</option>
              </select>
            </td>
          </ng-container>
          <ng-container matColumnDef="returnStatus">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Return&nbsp;Status </th>
            <td mat-cell *matCellDef="let item">
              <select class="form-select form-select-sm w-100" [(value)]="item.dispatchStatus"
                (selectionChange)="onDispatchStatusChange(item)">
                <option *ngFor="let s of dispatchStatuses" [value]="s.value">
                  {{ s.viewValue }}</option>
              </select>
            </td>
          </ng-container>
          <ng-container matColumnDef="returnConfirmationStatus">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Return&nbsp;Confirmation&nbsp;Status </th>
            <td mat-cell *matCellDef="let item">
              <select class="form-select form-select-sm w-100" [(value)]="item.dispatchStatus"
                (selectionChange)="onDispatchStatusChange(item)">
                <option *ngFor="let s of dispatchStatuses" [value]="s.value">
                  {{ s.viewValue }}</option>
              </select>
            </td>
          </ng-container>

          <!-- <ng-container matColumnDef="generic">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> Generic </th>
                <td mat-cell *matCellDef="let item"> 200 </td>
              </ng-container>
              <ng-container matColumnDef="ethical">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> Ethical </th>
                <td mat-cell *matCellDef="let item"> 150 </td>
              </ng-container>
              <ng-container matColumnDef="otc">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> OTC </th>
                <td mat-cell *matCellDef="let item"> 100 </td>
              </ng-container>

              <ng-container matColumnDef="finalAmount">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> Vitoxyz Amount </th>
                <td mat-cell *matCellDef="let item"> </td>
              </ng-container>

              <ng-container matColumnDef="status">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> Status </th>
                <td mat-cell *matCellDef="let item"> {{ item.status }} </td>
              </ng-container>

              <ng-container matColumnDef="taxAmount">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> Tax </th>
                <td mat-cell *matCellDef="let item"> {{ item.taxAmount | number:'1.2-2' }} </td>
              </ng-container>

              <ng-container matColumnDef="totalAmount">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> Total </th>
                <td mat-cell *matCellDef="let item"> {{ item.totalAmount | number:'1.2-2' }} </td>
              </ng-container>

              <ng-container matColumnDef="actions" stickyEnd>
                <th mat-header-cell *matHeaderCellDef> Actions </th>
                <td mat-cell *matCellDef="let item">
                  <button mat-icon-button color="primary" (click)="onView(item)">
                    <mat-icon>visibility</mat-icon>
                  </button>
                </td>
              </ng-container> -->

          <tr mat-header-row *matHeaderRowDef="processedColumns; sticky: true"></tr>
          <tr mat-row *matRowDef="let row; columns: processedColumns;"></tr>
        </table>
      </section>


    </div>
  </mat-tab>

</mat-tab-group>