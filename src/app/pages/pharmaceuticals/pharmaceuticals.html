<div class="table-container">
  <!-- Mat Tab Group -->
  <mat-tab-group (selectedTabChange)="onTabChange($event)" [(selectedIndex)]="activeTabIndex" animationDuration="300ms">

    <mat-tab label="Orders in Cart">
      <div class="tab-content pt-3">
        <div class="toolbar d-flex align-items-center mb-2">
          <mat-icon>filter_list</mat-icon>

          <mat-form-field appearance="outline" class="ms-2 small-select">
            <mat-label>Search Cart</mat-label>
            <input matInput (keyup)="applyCartFilter($event)" placeholder="Search by product, customer, etc.">
          </mat-form-field>
        </div>

        <table mat-table [dataSource]="cartOrders" matSort #cartSort="matSort">

          <ng-container matColumnDef="id">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Cart ID </th>
            <td mat-cell *matCellDef="let item"> {{ item.id }} </td>
          </ng-container>

          <ng-container matColumnDef="productName">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Product Name </th>
            <td mat-cell *matCellDef="let item"> {{ item.productName }} </td>
          </ng-container>

          <ng-container matColumnDef="brandName">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Brand </th>
            <td mat-cell *matCellDef="let item"> {{ item.brandName || 'N/A' }} </td>
          </ng-container>

          <ng-container matColumnDef="dosage">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Dosage </th>
            <td mat-cell *matCellDef="let item"> {{ item.dosage }} </td>
          </ng-container>

          <ng-container matColumnDef="productForm">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Form </th>
            <td mat-cell *matCellDef="let item"> {{ item.productForm }} </td>
          </ng-container>

          <ng-container matColumnDef="quantity">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Qty </th>
            <td mat-cell *matCellDef="let item"> {{ item.quantity }} </td>
          </ng-container>

          <ng-container matColumnDef="price">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Price </th>
            <td mat-cell *matCellDef="let item"> {{ item.price | number:'1.2-2' }} </td>
          </ng-container>

          <ng-container matColumnDef="totalPrice">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Total </th>
            <td mat-cell *matCellDef="let item"> {{ item.totalPrice | number:'1.2-2' }} </td>
          </ng-container>

          <ng-container matColumnDef="userName">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Customer </th>
            <td mat-cell *matCellDef="let item"> {{ item.userName }} </td>
          </ng-container>

          <ng-container matColumnDef="addedDate">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Added Date </th>
            <td mat-cell *matCellDef="let item">
              {{ item.addedDate | date:'medium' }}
            </td>
          </ng-container>

          <ng-container matColumnDef="actions" stickyEnd>
            <th mat-header-cell *matHeaderCellDef> Actions </th>
            <td mat-cell *matCellDef="let item">
              <button mat-icon-button color="primary" (click)="onView(item)">
                <mat-icon>visibility</mat-icon>
              </button>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="cartColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: cartColumns;"></tr>
        </table>

        <mat-paginator #cartPaginator [pageSizeOptions]="[5, 10, 20, 100]" showFirstLastButtons>
        </mat-paginator>
      </div>
    </mat-tab>

    <mat-tab label="Processed Orders">
      <div class="tab-content pt-3">
        <div class="toolbar d-flex align-items-center mb-2">
          <mat-icon>filter_list</mat-icon>
          <mat-form-field appearance="outline" class="ms-2 small-select">
            <mat-label>Filter by Status</mat-label>
            <mat-select [(value)]="selectedOrderType" (selectionChange)="onOrderTypeChange($event.value)">
              @for (type of orderStatuses; track type.value) {
              <mat-option [value]="type.value">
                {{ type.label | titlecase }}
              </mat-option>
              }
            </mat-select>
          </mat-form-field>
          <mat-form-field appearance="outline" class="ms-2 small-select">
            <mat-label>Search Orders</mat-label>
            <input matInput (keyup)="applyProcessedFilter($event)" placeholder="Search by order ID, customer, etc.">
          </mat-form-field>
        </div>

        <!-- Processed orders table -->
        <table mat-table [dataSource]="processedOrders" matSort #processedSort="matSort">

          <!-- All original columns -->
          <ng-container matColumnDef="orderId" sticky="true">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Order ID </th>
            <td mat-cell *matCellDef="let item"> {{ item.orderId }} </td>
          </ng-container>

          <ng-container matColumnDef="orderNumber" sticky="true">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Order Number </th>
            <td mat-cell *matCellDef="let item"> {{ item.orderNumber }} </td>
          </ng-container>

          <ng-container matColumnDef="userId">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> User ID </th>
            <td mat-cell *matCellDef="let item"> {{ item.userId }} </td>
          </ng-container>

          <ng-container matColumnDef="userName">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> User Name </th>
            <td mat-cell *matCellDef="let item"> {{ item.userName }} </td>
          </ng-container>

          <ng-container matColumnDef="userPhoneNumber">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Phone </th>
            <td mat-cell *matCellDef="let item"> {{ item.userPhoneNumber }} </td>
          </ng-container>

          <ng-container matColumnDef="userEmail">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Email </th>
            <td mat-cell *matCellDef="let item"> {{ item.userEmail }} </td>
          </ng-container>

          <ng-container matColumnDef="paymentStatus">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Payment Status </th>
            <td mat-cell *matCellDef="let item"> {{ item.paymentStatus }} </td>
          </ng-container>

          <ng-container matColumnDef="orderDate">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Order Date </th>
            <td mat-cell *matCellDef="let item"> {{ item.orderDate | date: 'medium' }} </td>
          </ng-container>

          <ng-container matColumnDef="expectedDeliveryDate">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Delivery Date </th>
            <td mat-cell *matCellDef="let item"> {{ item.expectedDeliveryDate | date: 'medium' }} </td>
          </ng-container>

          <ng-container matColumnDef="finalAmount">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Final Amount </th>
            <td mat-cell *matCellDef="let item">{{ item.finalAmount | number:'1.2-2' }} </td>
          </ng-container>

          <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Status </th>
            <td mat-cell *matCellDef="let item"> {{ item.status }} </td>
          </ng-container>

          <ng-container matColumnDef="taxAmount">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Tax </th>
            <td mat-cell *matCellDef="let item"> {{ item.taxAmount | number:'1.2-2' }} </td>
          </ng-container>

          <ng-container matColumnDef="totalAmount">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Total </th>
            <td mat-cell *matCellDef="let item"> {{ item.totalAmount | number:'1.2-2' }} </td>
          </ng-container>

          <ng-container matColumnDef="actions" stickyEnd>
            <th mat-header-cell *matHeaderCellDef> Actions </th>
            <td mat-cell *matCellDef="let item">
              <button mat-icon-button color="primary" (click)="onView(item)">
                <mat-icon>visibility</mat-icon>
              </button>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="processedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: processedColumns;"></tr>
        </table>

        <mat-paginator #processedPaginator [pageSizeOptions]="[5, 10, 20, 100]" showFirstLastButtons>
        </mat-paginator>
      </div>
    </mat-tab>
  </mat-tab-group>
</div>