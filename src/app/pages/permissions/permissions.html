<!-- <div class="d-flex justify-content-between">
  <h4>Role Wise Permissions</h4>
  <button matButton="tonal" (click)="savePermissions()">Save</button>
</div>

<div *ngFor="let roleGroup of rolePermissions.controls; let i=index" [formGroup]="roleGroup" class="example-section border-bottom pt-3">
  <h6 class="fw-bold">{{ roles[i]?.roleType }}</h6>
  <div class="row" formGroupName="permissions">
    <p class="col-4"><mat-checkbox [formControlName]="roles[i]?.roleType + ' Dashboard'">{{ roles[i]?.roleType }} Dashboard</mat-checkbox></p>
    <p class="col-4"><mat-checkbox formControlName="Manage">Manage</mat-checkbox></p>
    <p class="col-4"><mat-checkbox formControlName="Bookings">Staff Bookings</mat-checkbox></p>
    <p class="col-4"><mat-checkbox formControlName="Booking Payments">Booking Payments</mat-checkbox></p>
    <p class="col-4"><mat-checkbox formControlName="Duty Assigned">Duty Assigned</mat-checkbox></p>
    <p class="col-4"><mat-checkbox formControlName="Active Staff">Active Staff</mat-checkbox></p>
    <p class="col-4"><mat-checkbox formControlName="GPS Monitoring">GPS Monitoring</mat-checkbox></p>
    <p class="col-4"><mat-checkbox formControlName="GPS Deviation">GPS Deviation</mat-checkbox></p>
    <p class="col-4"><mat-checkbox formControlName="Bulk Assignment">Bulk Assignment</mat-checkbox></p>
    <p class="col-4"><mat-checkbox formControlName="Override Duties">Override Duties</mat-checkbox></p>
    <p class="col-4"><mat-checkbox formControlName="Cancel Booking">Cancel Booking</mat-checkbox></p>
    <p class="col-4"><mat-checkbox formControlName="Requested SubCategories">Requested SubCategories</mat-checkbox></p>
    <p class="col-4"><mat-checkbox formControlName="Re-Assigned Booking">Re-Assigned Booking</mat-checkbox></p>
    <p class="col-4"><mat-checkbox formControlName="SOS Staff">SOS Staff</mat-checkbox></p>
    <p class="col-4"><mat-checkbox formControlName="SOS Alerts">SOS Alerts</mat-checkbox></p>
    <p class="col-4"><mat-checkbox formControlName="Devices & Addresses">Devices & Addresses</mat-checkbox></p>
    <p class="col-4"><mat-checkbox formControlName="Roles">Roles</mat-checkbox></p>
    <p class="col-4"><mat-checkbox formControlName="Pharma">Pharma</mat-checkbox></p>
    <p class="col-4"><mat-checkbox formControlName="Staff Wallet">Staff Wallet</mat-checkbox></p>
    <p class="col-4"><mat-checkbox formControlName="Account">Account</mat-checkbox></p>
    <p class="col-4"><mat-checkbox formControlName="Prescriptions">Prescriptions</mat-checkbox></p>
    <p class="col-4"><mat-checkbox formControlName="Permissions">Permissions</mat-checkbox></p>
    <p class="col-4"><mat-checkbox formControlName="Diet Plans">Diet Plans</mat-checkbox></p>
    <p class="col-4"><mat-checkbox formControlName="Diet Subscription Plans">Diet Subscription Plans</mat-checkbox></p>
    <p class="col-4"><mat-checkbox formControlName="Ledgers">Ledgers</mat-checkbox></p>
    <p class="col-4"><mat-checkbox formControlName="Diet Bookings">Diet Bookings</mat-checkbox></p>
    <p class="col-4"><mat-checkbox formControlName="Diet Subscription">Diet Subscription</mat-checkbox></p>
    <p class="col-4"><mat-checkbox formControlName="Dietician Reports">Dietician Reports</mat-checkbox></p>
    <p class="col-4"><mat-checkbox formControlName="Settings">Settings</mat-checkbox></p>
  </div>
</div> -->
<div class="container-fluid p-4">
  <div class="mb-4 bg-white p-3 rounded shadow-sm border">
    <h4 class="m-0">Role Wise Permissions</h4>
    <small class="text-muted">Expand a role to edit and save its permissions individually.</small>
  </div>

  <form [formGroup]="permissionsForm">
    <mat-accordion multi>
      
      <mat-expansion-panel 
        *ngFor="let roleGroup of rolePermissionsArray.controls; let i=index" 
        [formGroup]="getGroup(roleGroup)"
        class="mb-3 border-0 shadow-sm">
        
        <mat-expansion-panel-header [class.sub-role-header]="roleGroup.get('isSubRole')?.value">
          <mat-panel-title>
            <div class="d-flex align-items-center" [class.ps-4]="roleGroup.get('isSubRole')?.value">
              <mat-icon class="me-2 text-secondary" *ngIf="roleGroup.get('isSubRole')?.value">subdirectory_arrow_right</mat-icon>
              <mat-icon class="me-2 text-info" *ngIf="!roleGroup.get('isSubRole')?.value">verified_user</mat-icon>
              
              <span [class.fw-light]="!roleGroup.get('isSubRole')?.value">
                {{ roleGroup.get('roleName')?.value }}
              </span>
              
              <span class="badge bg-light text-dark border ms-2" *ngIf="roleGroup.get('isSubRole')?.value">Sub-Role</span>
            </div>
          </mat-panel-title>
        </mat-expansion-panel-header>

        <div class="row pt-3 px-3" [formGroup]="getGroup(roleGroup.get('permissions'))">
          <div class="col-xl-3 col-lg-4 col-sm-6" *ngFor="let key of getPermissionKeys(roleGroup)">
            <mat-checkbox [formControlName]="key" color="primary" class="perm-check">
              <span class="text-wrap" style="font-size: 13px;">{{ key }}</span>
            </mat-checkbox>
          </div>
        </div>

        <mat-action-row>
          <button mat-flat-button color="primary" (click)="saveSingleRole(roleGroup)">
            Save {{ roleGroup.get('roleName')?.value }} Permissions
          </button>
        </mat-action-row>

      </mat-expansion-panel>

    </mat-accordion>
  </form>
</div>
